<?xml version="1.0"?>
<!--
Gazebo Configuration for Test Station - COMPLETE FIXED VERSION
Includes ALL joints (linear rails + leg) for proper TF tree
-->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="test_station_gazebo">

  <!-- Accept controller config path as parameter (passed from launch file) -->
  <xacro:arg name="controller_config_file" default="$(find test_station_simulation)/config/controller_full.yaml"/>

  <!-- ========================================= -->
  <!-- ROS2_CONTROL CONFIGURATION                -->
  <!-- ========================================= -->
  
  <ros2_control name="GazeboSimSystem" type="system">
    <hardware>
      <plugin>gz_ros2_control/GazeboSimSystem</plugin>
    </hardware>

    <!-- ============================================ -->
    <!-- LINEAR JOINTS (Passive - State Only)         -->
    <!-- ============================================ -->
    
    <!-- Linear Left-Right Joint (Prismatic) -->
    <joint name="linear_left_right_joint">
      <!-- State interfaces only - not controlled -->
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <!-- Linear Up-Down Joint (Prismatic) -->
    <joint name="linear_up_down_joint">
      <!-- State interfaces only - not controlled -->
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <!-- ============================================ -->
    <!-- LEG JOINTS (Active - Effort Controlled)      -->
    <!-- ============================================ -->

    <!-- Hip Joint (Revolute) -->
    <joint name="hip_joint">
      <command_interface name="effort">
        <param name="min">-50.0</param>
        <param name="max">50.0</param>
      </command_interface>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>

    <!-- Knee Joint (Revolute) -->
    <joint name="knee_joint">
      <command_interface name="effort">
        <param name="min">-50.0</param>
        <param name="max">50.0</param>
      </command_interface>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>

    <!-- Ankle Joint (Revolute) -->
    <joint name="ankle_joint">
      <command_interface name="effort">
        <param name="min">-50.0</param>
        <param name="max">50.0</param>
      </command_interface>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    
  </ros2_control>

  <!-- ========================================= -->
  <!-- GAZEBO PLUGINS                             -->
  <!-- ========================================= -->
  
  <gazebo>
    <!-- ros2_control plugin -->
    <plugin filename="gz_ros2_control-system" name="gz_ros2_control::GazeboSimROS2ControlPlugin">
      <parameters>$(arg controller_config_file)</parameters>
      <controller_manager_node_name>controller_manager</controller_manager_node_name>
    </plugin>

    <!-- Sensor Manager (for IMU, cameras, etc.) -->
    <plugin filename="libignition-gazebo-sensors-system.so"
            name="ignition::gazebo::systems::Sensors">
      <render_engine>ogre2</render_engine>
    </plugin>
  </gazebo>

  <!-- ========================================= -->
  <!-- GAZEBO LINK PROPERTIES                     -->
  <!-- ========================================= -->
  
  <!-- Base link -->
  <gazebo reference="base_link">
    <gravity>true</gravity>
    <self_collide>false</self_collide>
  </gazebo>

  <!-- Linear Left-Right Link -->
  <gazebo reference="linear_left_right_link">
    <gravity>true</gravity>
    <self_collide>false</self_collide>
  </gazebo>

  <!-- Linear Up-Down Link -->
  <gazebo reference="linear_up_down_link">
    <gravity>true</gravity>
    <self_collide>false</self_collide>
  </gazebo>

  <!-- Hip link -->
  <gazebo reference="hip_Link">
    <gravity>true</gravity>
    <self_collide>false</self_collide>
  </gazebo>

  <!-- Knee link -->
  <gazebo reference="knee_link">
    <gravity>true</gravity>
    <self_collide>false</self_collide>
  </gazebo>

  <!-- Ankle link -->
  <gazebo reference="ankle_link">
    <gravity>true</gravity>
    <self_collide>false</self_collide>
  </gazebo>

  <!-- Foot pointer -->
  <gazebo reference="foot_pointer">
    <gravity>true</gravity>
    <self_collide>false</self_collide>
  </gazebo>

  <!-- End effector -->
  <gazebo reference="end_effector">
    <gravity>true</gravity>
    <self_collide>false</self_collide>
  </gazebo>

</robot>